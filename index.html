<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Regatta Boat & Crew List</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f7fa;
      margin: 0;
      padding: 0;
      color: #0a1a33;
    }
    
    header {
      background: linear-gradient(90deg, #00068b, #00335b);
      padding: 20px;
      text-align: center;
      color: white;
    }

    <!-- Logo Container -->
<div class="logo-container">
  <img src="RSYS-logo.png" alt="RSYS Logo" class="logo" />
  <img src="J70-logo.png" alt="J/70 Logo" class="logo" />
</div>

<style>
/* Logos styling */
.logo-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 40px;
  flex-wrap: wrap;
  margin: 20px 0;
}

.logo-container .logo {
  max-height: 120px;
  width: auto;
  object-fit: contain;
}

@media (max-width: 600px) {
  .logo-container .logo {
    max-height: 60px;
  }
}
</style>


    .search-container {
      width: 90%;
      margin: 20px auto;
      text-align: right;
    }

    .search-container input {
      padding: 6px 12px;
      font-size: 1rem;
      width: 200px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    table {
      width: 90%;
      margin: 0 auto 40px auto;
      border-collapse: collapse;
      background-color: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      min-width: 650px;
    }

    th, td {
      padding: 12px;
      border-bottom: 1px solid #d7dce5;
    }

    th {
      background-color: #00335b;
      color: white;
      cursor: pointer;
    }

    /* Column alignment */
    th:nth-child(1), td:nth-child(1),
    th:nth-child(2), td:nth-child(2),
    th:nth-child(3), td:nth-child(3) { text-align: center; }

    th:nth-child(4), td:nth-child(4),
    th:nth-child(5), td:nth-child(5),
    th:nth-child(6), td:nth-child(6) { text-align: left; }

    tr:nth-child(even) { background-color: #eef2f7; }

    @media (max-width: 600px) {
      table { width: 100%; font-size: 14px; }
      th, td { padding: 8px; }
      .search-container { text-align: center; }
    }
  </style>
</head>
<body>

<header>
  <h1>Regatta Boat & Crew List</h1>
</header>

<div class="search-container">
  <input type="text" id="searchBox" placeholder="Search boats or crew..." />
</div>

<table id="boatTable">
  <thead>
    <tr>
      <th>Club</th>
      <th>Sail Number</th>
      <th>Bow Number</th>
      <th>Boat Name</th>
      <th>Skipper</th>
      <th>Crew</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const SHEET_ID = "1T3aZEkERIw8-vStNG9sKv1ybT0WJ2gkixx41Ga_8Iks";
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=0&cache_bust=${Date.now()}`;

let boatsData = [];
let sortDirections = {};

async function loadBoatsFromGoogleSheet() {
  try {
    const response = await fetch(CSV_URL);
    if (!response.ok) throw new Error("Failed to fetch sheet. Check sharing settings.");
    const csvText = await response.text();

    const rows = csvText.split("\n").map(r => r.split(","));
    const headers = rows.shift().map(h => h.trim());

    boatsData = rows
      .filter(r => r.length > 1) // skip empty rows
      .map(row => {
        let obj = {};
        row.forEach((cell,i) => obj[headers[i]] = cell.trim());
        return obj;
      });

    populateTable(boatsData);
    enableSorting();
  } catch(err) {
    console.error("Error loading Google Sheet:", err);
    alert("Error loading sheet: make sure the sheet is public and the ID is correct.");
  }
}

function populateTable(data) {
  const tbody = document.querySelector("#boatTable tbody");
  tbody.innerHTML = "";

  data.forEach(boat => {
    const tr = document.createElement("tr");

    ["Club","Sail Number","Bow Number","Boat Name","Skipper"].forEach(field => {
      const td = document.createElement("td");
      td.textContent = boat[field] || "";
      tr.appendChild(td);
    });

    const crewFields = Object.keys(boat)
      .filter(k => k.toLowerCase().startsWith("crew"))
      .sort((a,b) => parseInt(a.replace(/\D/g,"")) - parseInt(b.replace(/\D/g,"")));

   const crewTd = document.createElement("td");
crewTd.innerHTML = crewFields
  .map(k => boat[k])
  .filter(Boolean)
  .map(name => name.trim())
  .join("<br>"); // each crew member separated by a line break
tr.appendChild(crewTd);


    tbody.appendChild(tr);
  });
}

// ---------------- Sort Table ----------------
function enableSorting() {
  const headers = document.querySelectorAll("#boatTable th");
  headers.forEach((th,i) => {
    sortDirections[i] = 1;
    th.addEventListener("click", () => {
      sortTableByColumn(i);
      sortDirections[i] *= -1;
    });
  });
}

function sortTableByColumn(colIndex) {
  const tbody = document.querySelector("#boatTable tbody");
  const rows = Array.from(tbody.querySelectorAll("tr"));
  const isNumeric = v => /^\d+(\.\d+)?$/.test(v.replace(/\s+/g,''));

  rows.sort((a,b) => {
    const A = a.children[colIndex].innerText.trim();
    const B = b.children[colIndex].innerText.trim();
    if (isNumeric(A) && isNumeric(B)) {
      return (parseFloat(A) - parseFloat(B)) * sortDirections[colIndex];
    }
    return A.localeCompare(B) * sortDirections[colIndex];
  });

  rows.forEach(r => tbody.appendChild(r));
}

// ---------------- Search / Filter ----------------
document.getElementById("searchBox").addEventListener("input", e => {
  const query = e.target.value.toLowerCase();
  const filtered = boatsData.filter(boat =>
    Object.values(boat).some(val => val && val.toLowerCase().includes(query))
  );
  populateTable(filtered);
});

loadBoatsFromGoogleSheet();
</script>

</body>
</html>
